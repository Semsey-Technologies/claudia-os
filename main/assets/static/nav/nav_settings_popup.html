<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; padding: 0; background: rgba(0,0,0,0.95); color: #00FFCC; font-family: monospace; border: 2px solid #00FFCC; border-radius: 10px; overflow: hidden; font-size: 14px; }
        .header { background: rgba(0,255,204,0.2); padding: 10px; text-align: center; font-weight: bold; }
        .content { padding: 15px; display: flex; flex-direction: column; gap: 10px; }

        .row { display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; width: 100%; gap: 5px; }

        button { background: black; border: 1px solid #00FFCC; color: #00FFCC; padding: 8px; cursor: pointer; flex: 1; }
        button.active { background: #00FFCC; color: black; font-weight: bold; }

        .close-btn { width: 100%; margin-top: 15px; background: #333; border-color: #555; color: white; padding: 12px; }

        input[type="range"] { width: 100%; accent-color: #00FFCC; }
        input[type="color"] { border: none; width: 40px; height: 30px; background: none; cursor: pointer; }

        .label { font-size: 10px; color: #aaa; text-align: center; width: 40px;}
    </style>
</head>
<body>
<div class="header">DOCK CONFIGURATION</div>
<div class="content">

    <div>SAVE SLOT</div>
    <div class="btn-group">
        <button onclick="changeSlot(1)" id="slot-1">1</button>
        <button onclick="changeSlot(2)" id="slot-2">2</button>
        <button onclick="changeSlot(3)" id="slot-3">3</button>
        <button onclick="changeSlot(4)" id="slot-4">4</button>
        <button onclick="changeSlot(5)" id="slot-5">5</button>
    </div>

    <div>POSITION</div>
    <div class="btn-group">
        <button onclick="setPos('top')" id="btn-top">TOP</button>
        <button onclick="setPos('bottom')" id="btn-bottom">BOT</button>
        <button onclick="setPos('left')" id="btn-left">LEFT</button>
        <button onclick="setPos('right')" id="btn-right">RGT</button>
    </div>

    <div class="row">
        <span>AUTO-HIDE</span>
        <input type="checkbox" id="chk-autohide" style="transform:scale(1.5);">
    </div>

    <div class="row">
        <span>BAR COLOR</span>
        <input type="color" id="inp-bar-color" value="#000000">
    </div>

    <div>
        <div class="row"><span>ICON COLORS</span></div>
        <div class="row" style="justify-content: space-around;">
            <div><div class="label">CFG</div><input type="color" id="col-cog" value="#00FFCC"></div>
            <div><div class="label">SET</div><input type="color" id="col-sliders" value="#00FFCC"></div>
            <div><div class="label">BCK</div><input type="color" id="col-back" value="#00FFCC"></div>
            <div><div class="label">HOM</div><input type="color" id="col-home" value="#00FFCC"></div>
            <div><div class="label">REC</div><input type="color" id="col-recents" value="#00FFCC"></div>
            <div><div class="label">APP</div><input type="color" id="col-drawer" value="#00FFCC"></div>
        </div>
    </div>

    <div>
        <div class="row"><span>TRANSPARENCY</span> <span id="val-alpha">60</span>%</div>
        <input type="range" id="rng-alpha" min="0" max="100" value="60" oninput="upd('val-alpha', this.value)">
    </div>

    <div>
        <div class="row"><span>BAR SIZE</span> <span id="val-bar">200</span>px</div>
        <input type="range" id="rng-bar" min="60" max="300" value="200" oninput="upd('val-bar', this.value)">
    </div>

    <div>
        <div class="row"><span>HANDLE SIZE</span> <span id="val-handle">60</span>px</div>
        <input type="range" id="rng-handle" min="10" max="100" value="60" oninput="upd('val-handle', this.value)">
    </div>

    <button class="close-btn" onclick="applyAndClose()">SAVE & CLOSE</button>
</div>

<script>
    let currentPos = 'bottom';
    let currentSlot = 1;

    window.onload = function() {
        try { loadFromConfig(JSON.parse(AndroidSettings.getCurrentConfig())); }
        catch(e) { console.log("Defaults loaded"); }
    }

    function loadFromConfig(config) {
        currentSlot = config.slot;
        document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
        document.getElementById('slot-' + currentSlot).classList.add('active');

        setPos(config.pos);
        document.getElementById('chk-autohide').checked = config.autoHide;
        document.getElementById('rng-handle').value = config.handleSize;
        document.getElementById('rng-bar').value = config.barSize;
        document.getElementById('inp-bar-color').value = config.barColor;
        document.getElementById('rng-alpha').value = config.alpha;

        if(config.iconColors) {
            document.getElementById('col-cog').value = config.iconColors.cog;
            document.getElementById('col-sliders').value = config.iconColors.sliders;
            document.getElementById('col-back').value = config.iconColors.back;
            document.getElementById('col-home').value = config.iconColors.home;
            document.getElementById('col-recents').value = config.iconColors.recents;
            document.getElementById('col-drawer').value = config.iconColors.drawer;
        }

        upd('val-handle', config.handleSize);
        upd('val-bar', config.barSize);
        upd('val-alpha', config.alpha);
    }

    function changeSlot(s) {
        AndroidSettings.switchSlot(s);
        // Re-fetch config after switch (Kotlin will reload prefs and return new config)
        setTimeout(() => {
            try { loadFromConfig(JSON.parse(AndroidSettings.getCurrentConfig())); } catch(e){}
        }, 100);
    }

    function setPos(p) {
        currentPos = p;
        document.getElementById('btn-top').classList.remove('active');
        document.getElementById('btn-bottom').classList.remove('active');
        document.getElementById('btn-left').classList.remove('active');
        document.getElementById('btn-right').classList.remove('active');
        document.getElementById('btn-' + p).classList.add('active');
    }

    function upd(id, val) { document.getElementById(id).innerText = val; }

    function applyAndClose() {
        const autoHide = document.getElementById('chk-autohide').checked;
        const handlePx = parseInt(document.getElementById('rng-handle').value);
        const barPx = parseInt(document.getElementById('rng-bar').value);
        const barColor = document.getElementById('inp-bar-color').value;
        const alpha = parseInt(document.getElementById('rng-alpha').value);

        const iconColors = {
            cog: document.getElementById('col-cog').value,
            sliders: document.getElementById('col-sliders').value,
            back: document.getElementById('col-back').value,
            home: document.getElementById('col-home').value,
            recents: document.getElementById('col-recents').value,
            drawer: document.getElementById('col-drawer').value
        };

        AndroidSettings.saveConfig(currentSlot, currentPos, autoHide, handlePx, barPx, barColor, alpha, JSON.stringify(iconColors));
        AndroidSettings.closeSettings();
    }
</script>
</body>
</html>